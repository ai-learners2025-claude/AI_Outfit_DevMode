  <!DOCTYPE html>
  <html lang="zh-TW">
  <head>
    <meta charset="UTF-8" />
    
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>æˆ‘çš„è¡£æ«ƒ - MyStylist</title>
    {% load static %}
    <link rel="stylesheet" href="{% static 'css/base.css' %}" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" />
    <style>

      .closet-title {
        font-size: 1.8rem;
        font-weight: bold;
        margin-bottom: 24px;
      }

      .filter-bar {
        display: flex;
        gap: 16px;
        margin-bottom: 24px;
        flex-wrap: wrap;
      }

      .filter-btn {
        background-color: var(--accent-color);
        color: var(--text-color);
        border: none;
        border-radius: 20px;
        padding: 8px 18px;
        cursor: pointer;
        transition: all 0.3s ease;
        font-size: 0.95rem;
      }

      .filter-btn:hover {
        background-color: var(--hover-secondary);
        color: white;
      }

.item-card {
  display: block;
  visibility: visible;
  background-color: white;
  border-radius: 12px;
  overflow: hidden;
  box-shadow: 0 6px 12px var(--shadow-color);
  transition: transform 0.2s ease;
  position: relative;
  height: 190px;  /* å›ºå®šé«˜åº¦ä¾†ç¢ºä¿åœ–ç‰‡å¡ç‰‡çš„å¤§å°ä¸€è‡´ */
  max-height: 190px;
}
.item-card.hidden {
  visibility: hidden; /* ä½¿ç”¨ hidden è®“å¡ç‰‡éš±è—ï¼Œä½†ä¸æœƒå½±éŸ¿ grid */
}

.item-card img {
  width: 100%;
  height: 100%;
  object-fit: cover;
  object-position: center;
}

          .item-actions i {
        padding: 6px;
        border-radius: 50%;
        color: var(--main-color);
        font-size: 1rem;
        cursor: pointer;
        transition: all 0.3s ease;
      }

      .item-actions i:hover {
        background-color: var(--accent-color);
      }
      .more-options {
        position: absolute;
        top: 10px;
        right: 10px;
        cursor: pointer;
        padding: 6px;
        border-radius: 50%;
        transition: background-color 0.3s;
      }

      .more-options:hover {
        background-color: var(--accent-color);
      }

      .item-actions {
        display: none;
        position: absolute;
        top: 10px;
        right: 10px;
        background-color: white;
        box-shadow: 0 3px 6px rgba(0, 0, 0, 0.1);
        border-radius: 6px;
        z-index: 10;
        padding: 10px;
      }

      .item-actions button {
        background: var(--bg-color);
        border: none;
        padding: 8px 12px;
        font-size: 1rem;
        cursor: pointer;
        color: var(--text-color);
        transition: all 0.2s;
        width: 100%;
      }

      .item-actions button:hover {
        background-color: var(--accent-color);
      }


      @media (max-width: 600px) {
        .closet-title {
          font-size: 1.4rem;
        }

        .nav-icons {
          gap: 16px;
        }

        .nav-icons i {
          font-size: 1.3rem;
          padding: 4px;
        }

        main {
          padding: 90px 16px 30px;
        }
      }

      .upload-label {
        display: inline-flex;
        align-items: center;
        background-color: var(--main-color);
        color: white;
        padding: 10px 18px;
        border-radius: 30px;
        cursor: pointer;
        font-size: 1rem;
        transition: background-color 0.3s ease;
      }

      .upload-label:hover {
        background-color: var(--hover-main);
      }

      .upload-label i {
        margin-right: 8px;
      }
      .modal {
        background: white;
        border-radius: 12px;
        padding: 28px 32px;
        max-width: 380px;
        width: 90%;
        box-shadow: 0 15px 35px rgba(0,0,0,0.25);
        text-align: center;
        font-size: 1.1rem;
        color: var(--text-color);
        user-select: none;
        position: relative;
      }

      .modal-overlay {
        position: fixed;
        inset: 0;
        background-color: var(--modal-bg);
        display: none;
        justify-content: center;
        align-items: center;
        z-index: 9999;
      }

  .modal-buttons {
    display: flex;
    justify-content: flex-end;
    gap: 10px;
    margin-top: 20px;
  }

  .modal-button {
    padding: 8px 14px;
    border: none;
    border-radius: 6px;
    font-size: 1rem;
    cursor: pointer;
    transition: background-color 0.3s ease;
  }

  .modal-yes {
    background-color: var(--main-color);
    color: white;
  }

  .modal-yes:hover {
    background-color: var(--hover-main);
  }

  .btn-cancel {
    background-color: var(--accent-color);
    color: var(--text-color);
  }

  .btn-cancel:hover {
    background-color: var(--hover-secondary);
    color: white;
  }

  .modal-title {
    background: white;
    border-radius: 12px;
    padding: 24px 28px;
    width: 90%;
    max-width: 360px;
    box-shadow: 0 8px 20px var(--shadow-color);
    animation: fadeIn 0.3s ease;
    color: var(--text-color);
  }

  .modal-title h3 {
    margin-top: 0;
  }

  .modal-title select {
    width: 100%;
    padding: 10px;
    margin-top: 12px;
    font-size: 1rem;
    border: 1px solid var(--secondary-color);
    border-radius: 6px;
    background: var(--accent-color);
    color: var(--text-color);
  }


  @keyframes fadeIn {
    from {
      opacity: 0;
      transform: translateY(-10px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }

  .upload-float-btn {
    position: fixed;
    bottom: 24px;
    right: 24px;
    background-color: var(--main-color);
    color: white;
    width: 56px;
    height: 56px;
    border-radius: 50%;
    font-size: 24px;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    box-shadow: 0 6px 16px var(--shadow-color);
    z-index: 1000;
    transition: background-color 0.3s ease, transform 0.2s ease;
  }

  .upload-float-btn:hover {
    background-color: var(--hover-main);
    transform: scale(1.1);
  }

  /* ä¸Šå‚³å½ˆå‡ºæ¡† */
  .upload-popup {
    position: fixed;
    bottom: 90px;
    right: 24px;
    background: white;
    border: 1px solid var(--secondary-color);
    border-radius: 12px;
    box-shadow: 0 4px 12px var(--shadow-color);
    padding: 12px;
    display: none;
    flex-direction: column;
    gap: 10px;
    z-index: 1100;
    width: 160px;
  }

  .upload-popup select {
    width: 100%;
    padding: 6px;
    border-radius: 6px;
    border: 1px solid var(--secondary-color);
    font-size: 0.95rem;
  }

  .confirm-upload-btn {
    background-color: var(--main-color);
    color: white;
    border: none;
    border-radius: 6px;
    padding: 6px;
    cursor: pointer;
    transition: background 0.3s ease;
  }

  .confirm-upload-btn:hover {
    background-color: var(--hover-main);
  }

.filter-btn.active {
        background-color: var(--hover-secondary);
        color: white;
}
    </style>
  </head>
  <body>
    {% include "components/header.html" %}


  <!-- æµ®å‹•ä¸Šå‚³æŒ‰éˆ• -->
  <div class="upload-section">
    <div class="upload-float-btn" id="open-upload-menu" title="æ–°å¢è¡£ç‰©">
      <i class="fas fa-plus"></i>
    </div>
  </div>

  <!-- å½ˆå‡ºçš„å°æ¡† -->
  <div class="upload-popup" id="upload-popup">
    <select id="upload-category">
      <option value="" disabled selected>é¸æ“‡åˆ†é¡</option>
      </select>
    <button id="confirm-upload" class="confirm-upload-btn">é¸æ“‡åœ–ç‰‡</button>
  </div>

  <!-- éš±è—çš„æª”æ¡ˆè¼¸å…¥ -->
  <input type="file" id="upload-input" accept="image/*" hidden />

    <main>
      <h1 class="closet-title">æˆ‘çš„è¡£æ«ƒ</h1>
      <div class="filter-bar" id="filter-bar"></div>

      <div class="closet-grid-container">
        <section class="closet-grid"></section>
      </div>

  <!-- ç·¨è¼¯ Modal -->
  <div id="edit-modal" class="modal-overlay">
    <div class="modal-title">
      <h3>é¸æ“‡æ–°çš„è¡£ç‰©é¡åˆ¥</h3>
      <select id="edit-category"></select>

      <div class="modal-buttons">
        <button class="modal-button modal-yes" id="modal-yes">å„²å­˜</button>
        <button class="modal-button btn-cancel">å–æ¶ˆ</button>
      </div>
    </div>
  </div>

  <!-- åˆªé™¤ Modal -->
  <div class="modal-overlay" id="delete-modal" >
    <div class="modal" role="dialog" aria-modal="true" aria-labelledby="modal-title">
      <p id="modal-title">ä½ ç¢ºå®šè¦åˆªé™¤é€™ä»¶è¡£ç‰©å—ï¼Ÿ</p>
        <div class="modal-buttons">
          <button class="modal-button modal-yes" id="confirm-delete">ç¢ºèªåˆªé™¤</button>
          <button class="modal-button btn-cancel">å–æ¶ˆ</button>
        </div>
      </div>
  </div>
    
    </main>
    <!-- LINE LIFF SDK -->
    <script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>


  <script>
    const liffId = "2007741127-KXgn38Dn";  // ä½ çš„ LIFF ID
    // åªé ç¶²å€åƒæ•¸ ?dev=1 åˆ¤æ–·æ˜¯å¦ç‚ºé–‹ç™¼æ¨¡å¼
      const isDevelopmentMode = {% if debug %}true{% else %}false{% endif %} || new URLSearchParams(window.location.search).get('dev') === '1';
    const DEV_USER_ID = "dev_test_user_12345";  // é–‹ç™¼æ¨¡å¼å›ºå®š userId
    let globalUserId = "";
    let selectedFiles = [];
    let images = [];
    let idCounter = 0;
    let currentFilter = 'all';

    const fileInput = document.getElementById('upload-input');  // â† æ”¹å°æ‡‰ HTML id
    const gallery = document.querySelector('.closet-grid'); // â† ç›´æ¥æŠ“ class
    let status = null; // æ²’æœ‰ id="status"ï¼Œå°±ç›´æ¥ç”¨ console æˆ– alert

    document.addEventListener("DOMContentLoaded", async function () {
      if (isDevelopmentMode) {
        console.log("ğŸš€ é–‹ç™¼æ¨¡å¼ï¼šè·³é LINE LIFF é©—è­‰");
        globalUserId = DEV_USER_ID;
        await fetchGalleryFromBackend();
      } else {
        try {
          await liff.init({ liffId: liffId });
          if (!liff.isLoggedIn()) {
            liff.login();
          } else {
            const profile = await liff.getProfile();
            globalUserId = profile.userId;
            console.log("LINE UserId:", globalUserId);
            await fetchGalleryFromBackend();
          }
        } catch (err) {
          console.error("LIFF åˆå§‹åŒ–éŒ¯èª¤", err);
          alert('LIFF åˆå§‹åŒ–å¤±æ•—ï¼Œè«‹é‡æ–°æ•´ç†');
        }
      }
    });

function renderGallery() {
  gallery.innerHTML = ''; // å…ˆæ¸…ç©ºç¾æœ‰å…§å®¹

  images.forEach(img => {
    if (currentFilter !== 'all' && img.category !== currentFilter) return;

    const card = document.createElement('div');
    card.className = 'item-card';
    
    // åŠ ä¸Š data-category å±¬æ€§ï¼Œæ–¹ä¾¿ç¯©é¸
    card.setAttribute('data-id', img.id);
    card.setAttribute('data-category', img.category);

    const imgEl = document.createElement('img');
    imgEl.src = img.url;
    imgEl.alt = 'è¡£ç‰©';
    card.appendChild(imgEl);

    const moreBtn = document.createElement('div');
    moreBtn.className = 'more-options';
    moreBtn.innerHTML = '<i class="fas fa-ellipsis-h"></i>';
    card.appendChild(moreBtn);

    const actions = document.createElement('div');
    actions.className = 'item-actions';
    actions.innerHTML = `
      <i class="fas fa-edit" title="ç·¨è¼¯è¡£ç‰©"></i>
      <i class="fas fa-trash" title="åˆªé™¤è¡£ç‰©"></i>
    `;
    card.appendChild(actions);

    gallery.appendChild(card);

    bindItemCardEvents(card);
  });

  // å¼·åˆ¶åˆ·æ–° Grid ä½ˆå±€
  gallery.style.display = 'none';
  gallery.offsetHeight; // trigger reflow
  gallery.style.display = '';
}


    async function fetchGalleryFromBackend() {
      try {
        const res = await fetch(`/linebot/view_closet/${globalUserId}/`);
        const data = await res.json();

        images = (data.images || []).map(item => ({
          id: item.id,
          url: item.url.startsWith('/') ? item.url : '/' + item.url,  
          category: item.category,
        }));

        renderGallery();
      } catch (error) {
        console.error("è¼‰å…¥å¤±æ•—", error);
        alert('è¼‰å…¥è¡£æ«ƒåœ–ç‰‡å¤±æ•—');
      }
    }

    function toggleItemActions(actionsEl) {
      actionsEl.style.display = actionsEl.style.display === 'block' ? 'none' : 'block';
    }

function filterCategory(category) {
  currentFilter = category;

  // æ›´æ–°ç¯©é¸æ¢ä»¶å¾Œï¼Œç›´æ¥æ§åˆ¶é¡¯ç¤ºèˆ‡éš±è—ï¼Œè€Œä¸æ˜¯é‡æ¸²æŸ“æ‰€æœ‰å¡ç‰‡
  document.querySelectorAll('.item-card').forEach(card => {
    const match = category === 'all' || card.dataset.category === category;
    if (match) {
      card.classList.remove('hidden');  // é¡¯ç¤ºç¬¦åˆæ¢ä»¶çš„å¡ç‰‡
    } else {
      card.classList.add('hidden');     // éš±è—ä¸ç¬¦åˆæ¢ä»¶çš„å¡ç‰‡
    }
  });
}


      // === 1. å®šç¾©åˆ†é¡ Map ===
      const categoryMap = {
        top: 'ä¸Šè¡£',
        bottom: 'ä¸‹èº«',
        shoes: 'é‹å­',
        dress: 'æ´‹è£',
        skirt: 'è£™å­',
        outwear: 'å¤–æ­è¡£'
      };

      const filterBar = document.getElementById('filter-bar');
      const uploadBtn = document.getElementById('open-upload-menu');
      const uploadPopup = document.getElementById('upload-popup');
      const confirmUpload = document.getElementById('confirm-upload');
      const uploadInput = document.getElementById('upload-input');
      const CategorySelect = document.getElementById('upload-category');
      const editCategory = document.getElementById('edit-category');

      // === 2. å»ºç«‹ç¯©é¸æŒ‰éˆ• ===
      const allBtn = document.createElement('button');
      allBtn.className = 'filter-btn';
      allBtn.textContent = 'å…¨éƒ¨';
      allBtn.dataset.category = 'all';
      filterBar.appendChild(allBtn);

      for (const [key, label] of Object.entries(categoryMap)) {
      const btn = document.createElement('button');
      btn.className = 'filter-btn';
      btn.textContent = label;
      btn.dataset.category = key;
      filterBar.appendChild(btn);
      }

      // === 3. ä¸Šå‚³åˆ†é¡ä¸‹æ‹‰ ===
      for (const [key, label] of Object.entries(categoryMap)) {
      const option = document.createElement('option');
      option.value = key;
      option.textContent = label;
      CategorySelect.appendChild(option);
      }

      // === 4. ç·¨è¼¯ä¸‹æ‹‰ ===
      for (const [key, label] of Object.entries(categoryMap)) {
      const option = document.createElement('option');
      option.value = key;
      option.textContent = label;
      editCategory.appendChild(option);
      }

      // === 5. æµ®å‹•æŒ‰éˆ•ï¼šé–‹é—œä¸Šå‚³å½ˆçª— ===
      uploadBtn.addEventListener('click', function () {
      const isOpen = uploadPopup.style.display === 'flex';
      uploadPopup.style.display = isOpen ? 'none' : 'flex';
      if (!isOpen) {
          CategorySelect.value = ''; // æ¯æ¬¡æ‰“é–‹æ™‚é‡ç½®åˆ†é¡
      }
      });

      // === 6. é¸æ“‡åˆ†é¡å¾Œæ‰“é–‹æª”æ¡ˆä¸Šå‚³ ===
      confirmUpload.addEventListener('click', function () {
      if (!CategorySelect.value) {
          alert('è«‹å…ˆé¸æ“‡åˆ†é¡');
          return;
      }
      uploadPopup.style.display = 'none';
      uploadInput.click();
      });

      // é¸æ“‡å®Œåœ–ç‰‡å¾Œè‡ªå‹•ä¸Šå‚³
      uploadInput.addEventListener('change', async function (event) {
        const files = event.target.files;
        if (!files.length) {
          alert('è«‹é¸æ“‡è‡³å°‘ä¸€å¼µåœ–ç‰‡');
          return;
        }
        if (!globalUserId) {
          alert('ç”¨æˆ¶å°šæœªç™»å…¥ï¼Œè«‹é‡æ–°æ•´ç†æˆ–ç¨å¾Œå†è©¦');
          return;
        }
        if (!CategorySelect.value) {
          alert('è«‹å…ˆé¸æ“‡åˆ†é¡');
          return;
        }

      const formData = new FormData();
      formData.append('userId', globalUserId);
      formData.append('category', CategorySelect.value);
      Array.from(files).forEach(file => formData.append('images', file));

      try {
        const res = await fetch('/linebot/upload_closet/', {
          method: 'POST',
          body: formData
        });
        const result = await res.json();

        if (result.status === 'success') {
          alert('åœ–ç‰‡ä¸Šå‚³æˆåŠŸï¼');
          await fetchGalleryFromBackend(); // ä¸Šå‚³æˆåŠŸå¾Œåˆ·æ–°åœ–ç‰‡
        } else {
          alert(result.message || 'ä¸Šå‚³å¤±æ•—ï¼Œè«‹é‡è©¦');
        }
      } catch (err) {
        console.error(err);
        alert('ä¸Šå‚³éç¨‹ç™¼ç”ŸéŒ¯èª¤');
      }

      // æ¸…ç©ºæª”æ¡ˆè¼¸å…¥ï¼Œè®“åŒæª”æ¡ˆèƒ½é‡è¤‡é¸å–
      event.target.value = '';
    });

      // === 7. ç¯©é¸åŠŸèƒ½ ===
document.addEventListener('click', function (e) {
  if (e.target.classList.contains('filter-btn')) {
    // ç§»é™¤æ‰€æœ‰æŒ‰éˆ•çš„é¸ä¸­ç‹€æ…‹
    document.querySelectorAll('.filter-btn').forEach(btn => {
      btn.classList.remove('active');
    });

    // ç‚ºç•¶å‰é»æ“Šçš„ç¯©é¸æŒ‰éˆ•æ·»åŠ é¸ä¸­ç‹€æ…‹
    e.target.classList.add('active');

    currentFilter = e.target.dataset.category;  // æ›´æ–°ç¯©é¸æ¢ä»¶
    renderGallery();                            // é‡æ–°æ¸²æŸ“ç•«é¢
  }
});
      // === 9. å¡ç‰‡äº‹ä»¶ç¶å®š ===
      function bindItemCardEvents(card) {
      const moreOptions = card.querySelector('.more-options');
      const itemActions = card.querySelector('.item-actions');
      const editBtn = card.querySelector('.fa-edit');
      const deleteBtn = card.querySelector('.fa-trash');

      moreOptions.addEventListener('click', function (event) {
          itemActions.style.display = itemActions.style.display === 'block' ? 'none' : 'block';
          event.stopPropagation();
      });

      editBtn.addEventListener('click', function (event) {
          event.stopPropagation();
          selectedItemCard = card;
          const currentCategory = card.getAttribute('data-category');
          editCategory.value = currentCategory;  // é è¨­é¸æ“‡ç›®å‰åˆ†é¡
          openModal('edit-modal');
      });

      deleteBtn.addEventListener('click', function (event) {
          event.stopPropagation();
          selectedItemCard = card;
          openModal('delete-modal');
      });

      card.addEventListener('click', function () {
          itemActions.style.display = 'none';
      });
      }

      // === 10. Modal æ“ä½œ ===
      let selectedItemCard = null;
      function openModal(id) {
      document.getElementById(id).style.display = 'flex';
      }
      function closeModal(id) {
      document.getElementById(id).style.display = 'none';
      }

      // å„²å­˜ç·¨è¼¯
document.getElementById('modal-yes').addEventListener('click', async function () {
    console.log("ç·¨è¼¯æŒ‰éˆ•è¢«é»æ“Š");  // ç¢ºèªæ˜¯å¦è¢«è§¸ç™¼
    const selectedCategory = document.getElementById('edit-category').value;
    if (selectedItemCard) {
        const imageId = selectedItemCard.getAttribute('data-id');
        if (imageId) {
            await editImageCategory(Number(imageId), selectedCategory);
            selectedItemCard.setAttribute('data-category', selectedCategory);
        }
    }
    closeModal('edit-modal');
});

      // åˆªé™¤è¡£ç‰©
  document.getElementById('confirm-delete').addEventListener('click', async function () {
    if (selectedItemCard) {
      const imageId = selectedItemCard.getAttribute('data-id');
      if (!imageId) {
        alert('æ‰¾ä¸åˆ°åœ–ç‰‡ IDï¼Œç„¡æ³•åˆªé™¤');
        return;
      }
      try {
        const res = await fetch('/linebot/delete_closet_images/', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            userId: globalUserId,
            imageIds: [Number(imageId)],
          }),
        });
        const result = await res.json();
        if (result.status === 'success') {
          alert('åˆªé™¤æˆåŠŸ');
          await fetchGalleryFromBackend();  // é‡æ–°å¾å¾Œç«¯æ‹‰æœ€æ–°è³‡æ–™
        } else {
          alert(result.message || 'åˆªé™¤å¤±æ•—');
        }
      } catch (error) {
        console.error(error);
        alert('åˆªé™¤æ™‚ç™¼ç”ŸéŒ¯èª¤');
      }
      selectedItemCard = null;
      closeModal('delete-modal');
    }
  });


      // é—œé–‰ modal
      document.querySelectorAll('.btn-cancel').forEach((btn) => {
      btn.addEventListener('click', function () {
          closeModal('edit-modal');
          closeModal('delete-modal');
      });
      });

      // === 11. é»æ“Šä»»ä½•åœ°æ–¹é—œé–‰æ‰€æœ‰ item-actions ===
      document.addEventListener('click', function (e) {
      document.querySelectorAll('.item-actions').forEach(actions => {
          if (!actions.contains(e.target) && !e.target.closest('.more-options')) {
          actions.style.display = 'none';
          }
      });
      });

  // åˆªé™¤åœ–ç‰‡
  async function deleteSelected() {
    const selectedImages = images.filter(img => img.selected);
    if (selectedImages.length === 0) {
      alert('è«‹å…ˆé¸æ“‡è¦åˆªé™¤çš„åœ–ç‰‡');
      return;
    }
    if (!confirm(`ç¢ºå®šè¦åˆªé™¤ ${selectedImages.length} å¼µåœ–ç‰‡å—ï¼Ÿ`)) {
      return;
    }

    try {
      const res = await fetch('/linebot/delete_closet_images/', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({
          userId: globalUserId,
          imageIds: selectedImages.map(img => img.id),
        }),
      });
      const result = await res.json();
      if (result.status === 'success') {
        images = images.filter(img => !img.selected);
        status.innerText = `å·²åˆªé™¤ ${selectedImages.length} å¼µåœ–ç‰‡`;
        renderGallery();
      } else {
        status.innerText = 'åˆªé™¤å¤±æ•—ï¼Œè«‹ç¨å¾Œå†è©¦';
      }
    } catch (error) {
      status.innerText = 'åˆªé™¤æ™‚ç™¼ç”ŸéŒ¯èª¤';
      console.error(error);
    }
  }

  // ç·¨è¼¯åœ–ç‰‡åˆ†é¡
async function editImageCategory(imageId, newCategory) {
    try {
        console.log("ç·¨è¼¯è«‹æ±‚ç™¼é€ä¸­...", imageId, newCategory);  // ç¢ºèªåƒæ•¸
        const res = await fetch('/linebot/edit_closet_image_category/', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({
                userId: globalUserId,
                imageId: imageId,
                newCategory: newCategory,
            }),
        });
        const result = await res.json();
        console.log(result);  // è¼¸å‡ºå¾Œç«¯å›æ‡‰
        if (result.status === 'success') {
            alert('åˆ†é¡æ›´æ–°æˆåŠŸ');
            await fetchGalleryFromBackend();  // é‡æ–°æ‹‰å–æœ€æ–°è³‡æ–™
        } else {
            alert('æ›´æ–°åˆ†é¡å¤±æ•—');
        }
    } catch (error) {
        console.error("æ›´æ–°åˆ†é¡æ™‚ç™¼ç”ŸéŒ¯èª¤", error);
        status.innerText = 'æ›´æ–°åˆ†é¡æ™‚ç™¼ç”ŸéŒ¯èª¤';
    }
}
  </script>
    {% include   "components\footer.html" %}

  </body>
  </html>
